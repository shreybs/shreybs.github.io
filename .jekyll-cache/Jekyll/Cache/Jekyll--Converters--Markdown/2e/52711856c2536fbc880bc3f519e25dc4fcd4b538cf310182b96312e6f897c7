I"Ê#<h1 id="intro">Intro</h1>

<p>This writeup is THMâ€™s CC:Pentest Roomâ€™s Final Examâ€™s walkthrough which can be found <a href="https://tryhackme.com/room/ccpentesting">here</a>. The objective is to figure out the user flag and root flag.</p>

<p><strong>Tools used</strong>: Nmap, Gobuster, Hashcat, Privilege Escalation.</p>

<h1 id="analysis">Analysis</h1>

<h2 id="nmap">Nmap</h2>

<p>For information gathering and enumeration, I started off with an NMAP stealth scan.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-p-</span> <span class="nt">-v</span> <span class="nt">--min-parallelism</span> 100 <span class="nt">-sV</span> 10.10.24.168
</code></pre></div></div>
<p>Here, <em>-p-</em> scans all 65,535 ports, <em>-v</em> is a verbose flag, <em>â€“min-parallelism</em> probes parallelism to speed up the scan and <em>-sV</em> shows the version of services running on the target IP.</p>

<p>The results of the scan returned as follows</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nmap scan report <span class="k">for </span>10.10.24.168
Host is up <span class="o">(</span>0.31s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65532 closed ports
PORT      STATE    SERVICE VERSION
22/tcp    open     ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
80/tcp    open     http    Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
62157/tcp filtered unknown
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<p>So thereâ€™s 2 ports open with SSH and Apache. Weâ€™ll come back to this later, if needed.</p>

<h2 id="gobuster">GoBuster</h2>

<p>Gobuster is a directory bruteforcing tool that will search for hidden directories on the port 80 web server. Letâ€™s run the code below to see what it outputs</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster <span class="nb">dir</span> <span class="nt">-u</span> 10.10.24.168 <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/common.txt
</code></pre></div></div>

<p>The output was</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">===============================================================</span>
2020/10/21 22:27:08 Starting gobuster
<span class="o">===============================================================</span>
/.hta <span class="o">(</span>Status: 403<span class="o">)</span>
/.htaccess <span class="o">(</span>Status: 403<span class="o">)</span>
/.htpasswd <span class="o">(</span>Status: 403<span class="o">)</span>
/index.html <span class="o">(</span>Status: 200<span class="o">)</span>
/secret <span class="o">(</span>Status: 301<span class="o">)</span>
/server-status <span class="o">(</span>Status: 403<span class="o">)</span>
<span class="o">===============================================================</span>
2020/10/21 22:31:48 Finished
<span class="o">===============================================================</span>
</code></pre></div></div>

<p>Aha! Thereâ€™s a directory called â€˜secretâ€™ on the server. However, thereâ€™s nothing displayed if I visit it and nothing interesting in the source too. So I had to run gobuster on it again under that directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster <span class="nb">dir</span> <span class="nt">-u</span> 10.10.24.168/secret <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/common.txt
</code></pre></div></div>

<p>And this time I found</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/index.html <span class="o">(</span>Status: 200<span class="o">)</span>
</code></pre></div></div>

<p>Nothing again, but the hint says check for different extensions so letâ€™s check with other extensions like .txt.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster <span class="nb">dir</span> <span class="nt">-u</span> 10.10.24.168/secret <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/common.txt <span class="nt">-x</span> .txt
</code></pre></div></div>

<p>This shows a â€˜secret.txtâ€™ file. When I open this, I see</p>
<pre><code class="language-nyan:046385855FC9580393853D8E81F240B66FE9A7B8```">
Which seem like the credentials for the SSH client from the earlier NMAP scan. Let's use this to connect to the SSH server.

```bash
ssh nyan@10.10.24.168
</code></pre>
<p>But if I use the default password seen above, it doesnâ€™t work. As I suspected, this password is hashed. So I used <em>hashid</em> to verify the hash being used.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hashid 046385855FC9580393853D8E81F240B66FE9A7B8
</code></pre></div></div>
<p>And the results pointed it out to be SHA-1</p>

<p>To crack this, letâ€™s use <em>hashcat</em> as below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hashcat <span class="nt">-m</span> 100 <span class="nb">hash</span> /usr/share/wordlists/rockyou.txt <span class="nt">--force</span>
</code></pre></div></div>

<p>The <em>-m</em> flag sets the mode to 100 which pertains to SHA-1</p>

<p>The results of this crack were as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>046385855fc9580393853d8e81f240b66fe9a7b8:[redacted]
Session..........: hashcat
Status...........: Cracked
Hash.Name........: SHA1
Hash.Target......: 046385855fc9580393853d8e81f240b66fe9a7b8
Time.Started.....: Wed Oct 21 23:00:00 2020, (1 sec)
Time.Estimated...: Wed Oct 21 23:00:01 2020, (0 secs)
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:  3480.8 kH/s (0.57ms) @ Accel:1024 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests
Progress.........: 4972544/14344385 (34.67%)
Rejected.........: 0/4972544 (0.00%)
Restore.Point....: 4964352/14344385 (34.61%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidates.#1....: o103192 -&gt; nwcfleshwound
</code></pre></div></div>

<p>Success! The SSH password is as seen above next to the hash
Letâ€™s use that to login to the SSH server.</p>

<p>After logging in, running <em>ls</em> gives us the user flag.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nyan@ubuntu:~<span class="nv">$ </span><span class="nb">ls
</span>user.txt
nyan@ubuntu:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
<span class="o">[</span>redacted]
nyan@ubuntu:~<span class="nv">$ </span>
</code></pre></div></div>

<p>Now onto the root flag!</p>

<p>If I run</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nyan@ubuntu:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-latr</span>
total 36
drwxr-xr-x 3 root root 4096 Dec 20  2019 ..
<span class="nt">-rw-r--r--</span> 1 nyan nyan  655 Dec 20  2019 .profile
<span class="nt">-rw-r--r--</span> 1 nyan nyan 3771 Dec 20  2019 .bashrc
<span class="nt">-rw-r--r--</span> 1 nyan nyan  220 Dec 20  2019 .bash_logout
drwx------ 2 nyan nyan 4096 Dec 20  2019 .cache
<span class="nt">-rw-r--r--</span> 1 nyan nyan    0 Dec 20  2019 .sudo_as_admin_successful
drwxrwxr-x 2 nyan nyan 4096 Dec 20  2019 .nano
<span class="nt">-rw-rw-r--</span> 1 nyan nyan   14 Dec 20  2019 user.txt
<span class="nt">-rw-------</span> 1 nyan nyan   16 Dec 20  2019 .bash_history
drwxr-xr-x 4 nyan nyan 4096 Dec 20  2019 <span class="nb">.</span>
</code></pre></div></div>

<p>Thereâ€™s a hidden file, bash_history, opening it, I saw 3 lines of previous history.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su
<span class="nb">sudo </span>su
<span class="nb">exit</span>
</code></pre></div></div>

<p>When I run the second line, I successfully entered root
It seems that <em>sudo</em> had the SUID bit set on it.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nyan@ubuntu:~<span class="nv">$ </span><span class="nb">sudo </span>su
root@ubuntu:/home/nyan# <span class="nb">whoami
</span>root
root@ubuntu:/home/nyan# 
</code></pre></div></div>

<p>And so</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ubuntu:/home/nyan# <span class="nb">cd</span> ../..
root@ubuntu:/# <span class="nb">cd </span>root
root@ubuntu:~# <span class="nb">ls
</span>root.txt
root@ubuntu:~# <span class="nb">cat </span>root.txt
<span class="o">[</span>redacted]
</code></pre></div></div>

<p>We have successfully found the root flag and thereby finished this exam.</p>

<p><em>Thanks for following along.</em></p>

:ET